<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025åŒå­¸æœƒ äº’å‹•å¼é»é¤å–®</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutrals & Soft Terracotta -->
    <!-- Application Structure Plan: A multi-step, wizard-like SPA. Step 1: Name input. Step 2: Main course selection using a tabbed interface for categories to reduce cognitive load. Step 3: Combo, drinks, desserts, and upgrades. Step 4: A final order summary with real-time total calculation. This guided structure is more intuitive and manageable than a single long form, handling complex menu dependencies dynamically. -->
    <!-- Visualization & Content Choices: Menu categories are organized into interactive tabs (HTML/JS) to prevent user overload. Individual menu items are displayed as selectable cards in a responsive grid (HTML/Tailwind), which is more visually engaging than a simple list. The order summary and total price are dynamically updated text elements (JS) providing immediate feedback. All complex pricing and combo eligibility rules are handled by JS logic, simplifying the user experience. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #FDFBF8; /* Warm neutral background */
        }
        .tab-active {
            background-color: #D57A66; /* Soft Terracotta */
            color: white;
            border-color: #D57A66;
        }
        .tab-inactive {
            background-color: #F3E9E0; /* Lighter warm neutral */
            color: #8D6B5C; /* Muted brown */
            border-color: #E2D4C9;
        }
        .item-card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            border: 2px solid transparent;
        }
        .item-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.08);
        }
        .item-card.selected {
            border-color: #D57A66;
            box-shadow: 0 4px 10px rgba(213, 122, 102, 0.3);
            transform: translateY(-2px);
        }
        .btn-primary {
            background-color: #D57A66;
            color: white;
        }
        .btn-primary:hover {
            background-color: #C06C59;
        }
        .btn-secondary {
            background-color: #F3E9E0;
            color: #8D6B5C;
        }
         .btn-secondary:hover {
            background-color: #E2D4C9;
        }
        .summary-item {
            border-bottom: 1px dashed #E2D4C9;
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #F3E9E0;
        }
        ::-webkit-scrollbar-thumb {
            background: #D57A66;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #C06C59;
        }
        
        /* ç°¡æ˜“çš„ pulse å‹•ç•« */
        @keyframes pulse {
          0%, 100% { opacity: 1; }
          50% { opacity: 0.5; }
        }
        .animate-pulse {
          animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
    </style>
</head>
<body class="text-gray-700">

    <div class="container mx-auto p-4 md:p-8 max-w-7xl">

        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-[#8D6B5C]">2025åŒå­¸æœƒ ç·šä¸Šé»é¤</h1>
            <p class="mt-2 text-gray-500">è«‹å¡«å¯«æ‚¨çš„è¨‚å–®ï¼ŒæœŸå¾…èˆ‡æ‚¨ç›¸è¦‹ï¼</p>
        </header>

        <div class="lg:flex lg:space-x-8">
            <!-- Main Content -->
            <div class="lg:w-2/3">

                <!-- Step 1: User Info -->
                <div id="step-1" class="bg-white rounded-xl shadow-lg p-6 mb-6">
                    <h2 class="text-2xl font-bold mb-4 text-[#8D6B5C]">1. è«‹å‘Šè¨´æˆ‘å€‘æ‚¨æ˜¯èª°ï¼Ÿ</h2>
                    <label for="userName" class="block text-sm font-medium text-gray-600 mb-2">æ‚¨åœ¨å ±åæ™‚ä½¿ç”¨çš„å…¨å*</label>
                    <input type="text" id="userName" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#D57A66] focus:border-transparent" placeholder="è«‹è¼¸å…¥æ‚¨çš„å¤§å">
                </div>

                <!-- Step 2: Main Course -->
                <div id="step-2" class="bg-white rounded-xl shadow-lg p-6 mb-6">
                    <h2 class="text-2xl font-bold mb-4 text-[#8D6B5C]">2. é¸æ“‡æ‚¨çš„ä¸»é¤</h2>
                    <p class="text-sm text-gray-500 mb-4">æé†’ï¼šå–®é»ä¸€ä»½åƒ¹å€¼é«˜æ–¼ NT$150 å…ƒé¤é»ï¼Œæ‰å¯äº«å¥—é¤åŠ è³¼å„ªæƒ ã€‚</p>
                    
                    <nav id="category-tabs" class="flex flex-wrap gap-2 mb-6">
                        <!-- Tabs will be generated here -->
                    </nav>

                    <div id="menu-items" class="grid grid-cols-1 md:grid-cols-2 gap-4 h-[50vh] overflow-y-auto pr-2">
                        <!-- Menu items will be generated here -->
                    </div>
                </div>

                <!-- Step 3: Add-ons -->
                <div id="step-3" class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-2xl font-bold mb-4 text-[#8D6B5C]">3. å¥—é¤ã€é£²æ–™èˆ‡å…¶ä»–åŠ é»</h2>
                    
                    <!-- Combos -->
                    <div id="combo-section" class="mb-6">
                        <h3 class="text-lg font-semibold mb-3 border-l-4 border-[#D57A66] pl-3">å‡ç´šå¥—é¤</h3>
                        <div id="combo-options" class="space-y-2">
                             <!-- Combo options will be generated here -->
                        </div>
                         <p id="combo-alert" class="text-sm text-red-500 mt-2 hidden">æ‚¨çš„ä¸»é¤é‡‘é¡ä¸è¶³ NT$150ï¼Œç„¡æ³•å‡ç´šå¥—é¤ã€‚</p>
                    </div>

                    <!-- Drinks -->
                    <div class="mb-6">
                         <h3 class="text-lg font-semibold mb-3 border-l-4 border-[#D57A66] pl-3">é¸æ“‡é£²æ–™</h3>
                         <select id="drink-select" class="w-full p-3 border border-gray-300 rounded-lg">
                            <!-- Drink options will be generated here -->
                         </select>
                    </div>

                    <!-- Desserts -->
                     <div>
                         <h3 class="text-lg font-semibold mb-3 border-l-4 border-[#D57A66] pl-3">é¸æ“‡ç”œé»</h3>
                         <select id="dessert-select" class="w-full p-3 border border-gray-300 rounded-lg">
                             <!-- Dessert options will be generated here -->
                         </select>
                    </div>
                </div>
            </div>

            <!-- Sidebar: Order Summary & Live Feed -->
            <div class="lg:w-1/3 mt-8 lg:mt-0">
                
                <!-- æ‚¨çš„è¨‚å–®ç¸½è¦½ (Sticky) -->
                <div class="sticky top-8 bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-2xl font-bold mb-4 text-center border-b pb-3 text-[#8D6B5C]">æ‚¨çš„è¨‚å–®ç¸½è¦½</h2>
                    <div id="summary-user" class="text-center mb-4"></div>
                    <div id="summary-items" class="space-y-2 mb-4 h-64 overflow-y-auto pr-2">
                       <p class="text-center text-gray-400">æ‚¨çš„é¤é»å°‡é¡¯ç¤ºæ–¼æ­¤è™•</p>
                    </div>
                    <div class="border-t pt-4">
                        <div class="flex justify-between items-center text-2xl font-bold text-[#8D6B5C]">
                            <span>ç¸½è¨ˆï¼š</span>
                            <span id="total-price">NT$ 0</span>
                        </div>
                    </div>
                    <button id="submit-order" class="w-full mt-6 py-3 rounded-lg font-bold text-lg btn-primary transition-transform transform hover:scale-105">
                        ç¢ºèªé€å‡ºè¨‚å–®
                    </button>
                    <div id="confirmation-message" class="text-center mt-4 text-green-600 font-bold hidden">
                        âœ“ æ„Ÿè¬æ‚¨ï¼è¨‚å–®å·²è¨˜éŒ„ã€‚
                    </div>
                </div>
                
                <!-- æ–°å¢ï¼šå³æ™‚é»é¤å‹•æ…‹ -->
                <div class="mt-8 bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-2xl font-bold mb-4 text-center border-b pb-3 text-[#8D6B5C]">
                        <span class="inline-block animate-pulse mr-2 text-red-500">ğŸ”´</span>
                        å³æ™‚é»é¤å‹•æ…‹
                    </h2>
                    <div id="live-orders-list" class="space-y-3 h-96 overflow-y-auto pr-2">
                        <p id="live-orders-loading" class="text-center text-gray-400">æ­£åœ¨è¼‰å…¥å·²é»é¤åå–®...</p>
                        <!-- Live orders will be injected here -->
                    </div>
                </div>
                
            </div>
        </div>
    </div>

    <script>
        // --- â˜…â˜…â˜… é—œéµé» â˜…â˜…â˜… ---
        // æˆ‘å·²ç¶“å¹«æ‚¨æŠŠæ‚¨æä¾›çš„ç¶²å€å¡«å¥½äº†ï¼
        const BACKEND_BASE_URL = 'https://orderapp.zeabur.app';

        const menuData = {
            categories: ["ç¶“å…¸æ—©åˆé¤", "æ³•å¼åå¸ç­å°¼è¿ªå…‹è›‹", "ç¾å¼æ­å§†è›‹æ²", "è¥¿ç­ç‰™çƒ˜è›‹", "æ¼¢å ¡", "ä¸‰æ˜æ²»", "ç¾©å¤§åˆ©éºµ", "ç‡‰é£¯", "å’–å“©è›‹åŒ…é£¯", "æ’é¤", "æ²™æ‹‰", "å¢¨è¥¿å“¥æ²é¤…/å¡èè’‚äº", "Pizza", "å…’ç«¥é¤", "é–‹èƒƒèœ/é»å¿ƒ"],
            items: {
                "ç¶“å…¸æ—©åˆé¤": [
                    { name: "ä¸‰éš»å°è±¬ (ç«è…¿/é¦™è…¸/åŸ¹æ ¹)", price: 260 }, { name: "è¿·è¿­é¦™é›è…¿æ’", price: 340 }, { name: "é‡Œè‚Œè±¬æ’", price: 290 }, { name: "éª°å­ç‰›è‚‰", price: 370 }, { name: "é¦™ç…é­šæ’", price: 290 }, { name: "ç¶œåˆæ™‚è”¬", price: 260 }
                ],
                "æ³•å¼åå¸ç­å°¼è¿ªå…‹è›‹": [
                    { name: "ç•ªèŒ„è èœè‡è‡", price: 260 }, { name: "éµæ¿ç‰›è‚‰èµ·å¸", price: 320 }, { name: "ç‡»é®­è˜†ç­ç”Ÿèœ", price: 320 }
                ],
                "ç¾å¼æ­å§†è›‹æ²": [
                    { name: "ç¶œåˆè‚‰ (åŸ¹æ ¹/ç«è…¿/é¦™è…¸)", price: 280 }, { name: "ç¶œåˆè”¬èœ", price: 260 }, { name: "ç¶œåˆæµ·é®®", price: 330 }, { name: "å¢¨è¥¿å“¥è¾£å‘³ç‰›è‚‰", price: 300 }
                ],
                "è¥¿ç­ç‰™çƒ˜è›‹": [
                    { name: "è˜‘è‡è èœè•ƒèŒ„", price: 260 }, { name: "æ´‹è”¥ç‰›è‚‰é¦¬éˆ´è–¯", price: 320 }, { name: "æ«›ç“œé®®è¦å»ä»”é­š", price: 320 }
                ],
                "æ¼¢å ¡": [
                    { name: "å¥½éé›™æ‹¼æ¼¢å ¡", price: 420 }, { name: "ç¶“å…¸èµ·å¸ç‰›è‚‰å ¡", price: 280 }, { name: "å¥½äº‹èŠ±ç”Ÿç‰›è‚‰å ¡", price: 300 }, { name: "æ¾éœ²è‡è‡ç‰›è‚‰å ¡", price: 320 }, { name: "å¤å¨å¤·ç‚¸è¦ç‰›è‚‰å ¡", price: 380 }, { name: "æ°´ç‰›åŸç‚¸é›æ¼¢å ¡", price: 260 }, { name: "å¡”å¡”é±ˆé­šæ’æ¼¢å ¡", price: 240 }
                ],
                "ä¸‰æ˜æ²»": [
                    { name: "ç‚¸è±¬æ’ç¸½åŒ¯ä¸‰æ˜æ²»", price: 280 }, { name: "é¦™æª¸é’é†¬é›è‚‰ä¸‰æ˜æ²»", price: 250 }, { name: "é…ªæ¢¨ç¶œåˆè‡ä¸‰æ˜æ²»", price: 240 }, { name: "ç‡»é®­é­šæ³•å¼åå¸", price: 300 }
                ],
                "ç¾©å¤§åˆ©éºµ": [
                    { name: "æ˜å¤ªå­é¦™ç…å¹²è²éºµ", price: 300 }, { name: "æ³¢éš†é‚£è‚‰é†¬éºµ", price: 250 }, { name: "è›‹é»ƒé†¬åŸ¹æ ¹éºµ", price: 250 }, { name: "æ¼å¤«èŒ„æ±æµ·é®®éºµ", price: 280 }, { name: "æ¸…ç‚’è¾£å‘³æ™‚è”¬éºµ", price: 250 }, { name: "å¢¨è¥¿å“¥å“¥åª½è¾£é›ç¿…å°–éºµ", price: 300 }, { name: "æ¾éœ²ç‰›è‚èŒè‡é›è‚‰éºµ", price: 300 }
                ],
                "ç‡‰é£¯": [
                    { name: "æ¾éœ²ç‰›è‚èŒè‡ç‡‰é£¯", price: 260 }, { name: "æ˜å¤ªå­é®­é­šç‡‰é£¯", price: 320 }, { name: "å¥½éå¾·åœ‹æµ·é®®ç‡‰é£¯", price: 340 }, { name: "é€æŠ½é›è‚‰é’é†¬ç‡‰é£¯", price: 300 }, { name: "éª°å­ç‰›è èœå¥¶æ²¹ç‡‰é£¯", price: 340 }
                ],
                "å’–å“©è›‹åŒ…é£¯": [
                    { name: "ç‚¸è±¬æ’å’–å“©è›‹åŒ…é£¯", price: 280 }, { name: "é¦™ç…é›è…¿æ’å’–å“©è›‹åŒ…é£¯", price: 300 }, { name: "ç‚’ç¶œåˆæ™‚è”¬å’–å“©è›‹åŒ…é£¯", price: 250 }, { name: "ç‚¸è¦å’–å“©è›‹åŒ…é£¯", price: 260 }
                ],
                "æ’é¤": [
                    { name: "å·´ä¼åˆ©äºè±¬è…³", price: 500 }, { name: "å¥½éä¸»å»šç‰›æ’", price: 500 }, { name: "é¦™ç…å¤§æ‰é±ˆ", price: 400 }
                ],
                "æ²™æ‹‰": [
                    { name: "å¥½éä¸»å»šæ²™æ‹‰", price: 300 }, { name: "æº«è”¬èœç¿ æ¨‚æ²™æ‹‰", price: 280 }, { name: "ç¶“å…¸å‡±è–©æ²™æ‹‰", price: 240 }
                ],
                "å¢¨è¥¿å“¥æ²é¤…/å¡èè’‚äº": [
                    { name: "[æ²é¤…] é…ªæ¢¨ç”Ÿèœ", price: 200 }, { name: "[æ²é¤…] é¦™æ–™é›è‚‰", price: 200 }, { name: "[æ²é¤…] è²»åŸç‰›è‚‰", price: 240 }, { name: "[å¡è] è”¬èœ", price: 200 }, { name: "[å¡è] é›", price: 220 }, { name: "[å¡è] ç‰›", price: 220 }
                ],
                "Pizza": [
                    { name: "å¤å¨å¤· 2.0", price: 240 }, { name: "æ¾éœ²è‡è‡", price: 260 }, { name: "é’é†¬çƒ¤é›é®®è¦", price: 280 }
                ],
                "å…’ç«¥é¤": [
                    { name: "å…’ç«¥é¤ - è‚‰é†¬é€šå¿ƒéºµ", price: 240 }, { name: "å…’ç«¥é¤ - èµ·å¸é€šå¿ƒéºµ", price: 240 }, { name: "å…’ç«¥é¤ - å¥¶æ²¹é›è‚‰è èœç‡‰é£¯", price: 240 }, { name: "å…’ç«¥é¤ - èµ·å¸ç‰›è‚‰å°æ¼¢å ¡", price: 240 }, { name: "å…’ç«¥é¤ - å¥½éå…’ç«¥ä¸‰æ˜æ²»", price: 240 }, { name: "å…’ç«¥é¤ - å…’ç«¥æ—©åˆé¤", price: 240 }
                ],
                 "é–‹èƒƒèœ/é»å¿ƒ": [
                    { name: "å¥½éæ‹¼ç›¤", price: 420, type: 'addon' }, { name: "æ‘©ä½æ‹‰æ‹‰èµ·å¸æ¢", price: 120, type: 'addon' }, { name: "é¦™é…¥é±ˆé­šæ¢", price: 120, type: 'addon' }, { name: "æ–°é®®æ´‹è”¥åœˆ", price: 140, type: 'addon' }, { name: "è‹±å¼ç‚¸é­šè–¯æ¢", price: 200, type: 'addon' }, { name: "é¢¨å‘³åœ°ç“œæ¢", price: 100, type: 'addon' }, { name: "ä»Šæ—¥æ¿ƒæ¹¯", price: 60, type: 'addon' }
                ]
            },
            combos: [
                { id: 'no-combo', name: "å¦ (å–®é»ï¼Œä¸åŠ å¥—é¤)", price: 0 },
                { id: 'A', name: "A: æ¯æ—¥æ¿ƒæ¹¯+å¤§è’œéºµåŒ…+ç”°åœ’æ²™æ‹‰", price: 120 },
                { id: 'B', name: "B: ä»»é¸140å…ƒé£²å“ æˆ– ç”œé»", price: 120 },
                { id: 'C', name: "C: å¥—é¤A + å¥—é¤B", price: 220 },
                { id: 'D', name: "D: å¥—é¤A + B + ä»»é¸140å…ƒç”œé»", price: 300 }
            ],
            drinks: [
                { name: "ä¸é»é£²æ–™", price: 0 }, { name: "ç¾å¼å’–å•¡", price: 100 }, { name: "å¥½éæ‹¿éµ", price: 120 }, { name: "é»‘ç³–æ‹¿éµ", price: 140 }, { name: "é®®å¥¶æ²¹æ‘©å¡å’–å•¡", price: 140 }, { name: "è¥¿è¥¿é‡Œå†°å’–å•¡", price: 140 }, { name: "å¥½éé®®å¥¶èŒ¶", price: 120 }, { name: "é»‘ç³–é®®å¥¶èŒ¶", price: 140 }, { name: "ç„¦ç³–æŠ¹èŒ¶æ­è•¾", price: 140 }, { name: "å¯å¯æ­è•¾", price: 140 }, { name: "ä½›èŠæ˜ä¼¯çˆµé®®å¥¶èŒ¶", price: 180 }, { name: "å¥‡ç•°æœé³³æ¢¨è˜‹æœæ±", price: 140 }, { name: "ç´…è˜¿è””é³³æ¢¨è˜‹æœæ±", price: 140 }, { name: "ç«é¾æœèŠ­æ¨‚æŸ³æ©™æ±", price: 140 }, { name: "ç²¾é¸è¤‡æ–¹èŒ¶", price: 120 }, { name: "å¥½éæ–°é®®æ°´æœèŒ¶", price: 140 }, { name: "é…ªæ¢¨é¦™è•‰", price: 140 }, { name: "ç¶œåˆé‡è“", price: 140 }, { name: "ç«é¾æœé³³æ¢¨", price: 140 }, { name: "é¦™è‰å¥¶æ˜”", price: 140 }, { name: "Oreoå¥¶æ˜”", price: 160 }, { name: "èŠéº»æŠ¹èŒ¶å¥¶æ˜”", price: 180 }, { name: "ç¶“å…¸è«å¸Œæ‰˜ (ç„¡é…’ç²¾)", price: 140 }, { name: "ç¶“å…¸è«å¸Œæ‰˜ (å«é…’ç²¾)", price: 200 }
            ],
            desserts: [
                 { name: "ä¸é»ç”œé»", price: 0 }, { name: "ç¶œåˆæ°´æœæ³•å¼åå¸", price: 220 }, { name: "ç„¦ç³–å …æœèŠ±ç”Ÿé†¬ç…é¤…", price: 220 }, { name: "å¸ƒæœ—å°¼å†°æ·‡æ·‹", price: 180 }, { name: "ä¼¯çˆµæˆšé¢¨é»‘èŠéº»å¥¶æ²¹", price: 140 }, { name: "å¥½éææ‹‰ç±³è˜‡", price: 140 }
            ]
        };

        let currentOrder = {
            user: '',
            mainCourse: null,
            combo: null,
            drink: null,
            dessert: null,
            totalPrice: 0
        };

        // --- æ–°å¢çš„å‡½å¼ï¼šæŠ“å–ä¸¦é¡¯ç¤ºå³æ™‚è¨‚å–® ---
        async function fetchLiveOrders() {
            const liveOrdersList = document.getElementById('live-orders-list');
            const loadingText = document.getElementById('live-orders-loading');

            // æª¢æŸ¥ URL æ˜¯å¦å·²è¨­å®š
            if (BACKEND_BASE_URL.includes('your-backend-service-name')) {
                if (loadingText) loadingText.textContent = 'ä¸»è¾¦äººå°šæœªè¨­å®šå¾Œç«¯ç¶²å€';
                return;
            }

            try {
                // ä½¿ç”¨åŸºç¤ç¶²å€ + /orders
                const response = await fetch(`${BACKEND_BASE_URL}/orders`);
                if (!response.ok) throw new Error('Failed to fetch orders');
                
                const orders = await response.json();
                
                if (orders.length === 0) {
                    liveOrdersList.innerHTML = '<p class="text-center text-gray-400">ç›®å‰å°šç„¡è¨‚å–®ï¼Œå¿«ä¾†æ¶é ­é¦™ï¼</p>';
                    return;
                }

                // å°‡è¨‚å–®è³‡æ–™è½‰è­¯ç‚º HTML
                liveOrdersList.innerHTML = orders.map(order => `
                    <div class="summary-item flex justify-between items-center py-2">
                        <div>
                            <p class="font-bold">${order.user_name}</p>
                            <p class="text-sm text-gray-600">${order.main_course}</p>
                        </div>
                        <span class="font-medium text-[#8D6B5C]">NT$ ${order.total}</span>
                    </div>
                `).join('');

            } catch (error) {
                console.error('Error fetching live orders:', error);
                liveOrdersList.innerHTML = '<p class="text-center text-red-500">ç„¡æ³•è¼‰å…¥è¨‚å–®...è«‹ç¨å¾Œå†è©¦</p>';
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const categoryTabs = document.getElementById('category-tabs');
            const menuItemsContainer = document.getElementById('menu-items');
            const comboOptionsContainer = document.getElementById('combo-options');
            const drinkSelect = document.getElementById('drink-select');
            const dessertSelect = document.getElementById('dessert-select');
            const userNameInput = document.getElementById('userName');

            function renderTabs() {
                categoryTabs.innerHTML = menuData.categories.map((cat, index) => `
                    <button class="tab-button py-2 px-4 rounded-full font-semibold border-2 ${index === 0 ? 'tab-active' : 'tab-inactive'}" data-category="${cat}">
                        ${cat}
                    </button>
                `).join('');
            }

            function renderMenuItems(category) {
                const items = menuData.items[category] || [];
                menuItemsContainer.innerHTML = items.map(item => `
                    <div class="item-card bg-gray-50 rounded-lg p-4 cursor-pointer border-2 border-transparent" data-name="${item.name}" data-price="${item.price}" data-category="${category}">
                        <div class="flex justify-between items-start">
                            <h4 class="font-bold text-gray-800">${item.name}</h4>
                            <span class="font-semibold text-[#8D6B5C]">NT$ ${item.price}</span>
                        </div>
                    </div>
                `).join('');
            }

            function renderCombos() {
                comboOptionsContainer.innerHTML = menuData.combos.map(combo => `
                    <label class="flex items-center p-3 rounded-lg hover:bg-gray-50">
                        <input type="radio" name="combo" class="h-4 w-4 text-[#D57A66] focus:ring-[#D57A66]" value="${combo.id}" ${combo.id === 'no-combo' ? 'checked' : ''}>
                        <span class="ml-3 text-gray-700">${combo.name} (+NT$ ${combo.price})</span>
                    </label>
                `).join('');
            }
            
            function renderSelectOptions(selectElement, options) {
                selectElement.innerHTML = options.map(opt => `<option value="${opt.name}" data-price="${opt.price}">${opt.name} - NT$ ${opt.price}</option>`).join('');
            }

            function updateSummary() {
                const summaryItems = document.getElementById('summary-items');
                const totalPriceEl = document.getElementById('total-price');
                const summaryUser = document.getElementById('summary-user');
                let total = 0;
                let summaryHTML = '';

                summaryUser.innerHTML = `<p class="font-bold text-lg">${currentOrder.user || 'è¨‚é¤äºº'}</p>`;
                
                if (currentOrder.mainCourse) {
                    summaryHTML += `<div class="summary-item flex justify-between py-2"><span class="flex-1">${currentOrder.mainCourse.name}</span><span class="font-medium">NT$ ${currentOrder.mainCourse.price}</span></div>`;
                    total += currentOrder.mainCourse.price;
                }

                if (currentOrder.combo && currentOrder.combo.id !== 'no-combo') {
                    summaryHTML += `<div class="summary-item flex justify-between py-2"><span class="flex-1">${currentOrder.combo.name}</span><span class="font-medium">+NT$ ${currentOrder.combo.price}</span></div>`;
                    total += currentOrder.combo.price;
                }

                let drinkPrice = 0;
                if (currentOrder.drink && currentOrder.drink.name !== 'ä¸é»é£²æ–™') {
                    drinkPrice = currentOrder.drink.price;
                    // å¥—é¤ B, C, D éƒ½æœ‰å« $140 é£²æ–™
                    if ((currentOrder.combo?.id === 'B' || currentOrder.combo?.id === 'C' || currentOrder.combo?.id === 'D') && drinkPrice <= 140) {
                       drinkPrice = 0; // Covered by combo
                    }
                    if (drinkPrice > 0){
                        summaryHTML += `<div class="summary-item flex justify-between py-2"><span class="flex-1">é£²å“: ${currentOrder.drink.name}</span><span class="font-medium">+NT$ ${drinkPrice}</span></div>`;
                        total += drinkPrice;
                    } else {
                         summaryHTML += `<div class="summary-item flex justify-between py-2"><span class="flex-1">é£²å“: ${currentOrder.drink.name}</span><span class="font-medium text-green-600">å¥—é¤å…§å«</span></div>`;
                    }
                }

                let dessertPrice = 0;
                if (currentOrder.dessert && currentOrder.dessert.name !== 'ä¸é»ç”œé»') {
                    dessertPrice = currentOrder.dessert.price;
                     // å¥—é¤ D å«ç”œé»; å¥—é¤ B é£²æ–™ç”œé»äºŒé¸ä¸€
                     if ((currentOrder.combo?.id === 'D' || (currentOrder.combo?.id === 'B' && (!currentOrder.drink || currentOrder.drink.name === 'ä¸é»é£²æ–™'))) && dessertPrice <= 140) {
                        dessertPrice = 0; // Covered by combo
                    }
                    if (dessertPrice > 0){
                         summaryHTML += `<div class="summary-item flex justify-between py-2"><span class="flex-1">ç”œé»: ${currentOrder.dessert.name}</span><span class="font-medium">+NT$ ${dessertPrice}</span></div>`;
                         total += dessertPrice;
                    } else {
                         summaryHTML += `<div class="summary-item flex justify-between py-2"><span class="flex-1">ç”œé»: ${currentOrder.dessert.name}</span><span class="font-medium text-green-600">å¥—é¤å…§å«</span></div>`;
                    }
                }
                
                summaryItems.innerHTML = summaryHTML || `<p class="text-center text-gray-400">æ‚¨çš„é¤é»å°‡é¡¯ç¤ºæ–¼æ­¤è™•</p>`;
                totalPriceEl.textContent = `NT$ ${total}`;
                currentOrder.totalPrice = total; // å„²å­˜ç¸½é‡‘é¡
            }

            function checkComboEligibility() {
                const comboAlert = document.getElementById('combo-alert');
                const comboRadios = document.querySelectorAll('input[name="combo"]');
                const eligible = currentOrder.mainCourse && currentOrder.mainCourse.price >= 150;

                comboAlert.classList.toggle('hidden', eligible);
                comboRadios.forEach(radio => {
                    if (radio.value !== 'no-combo') {
                         radio.disabled = !eligible;
                    }
                });
                
                if (!eligible && currentOrder.combo?.id !== 'no-combo') {
                    document.querySelector('input[name="combo"][value="no-combo"]').checked = true;
                    currentOrder.combo = menuData.combos.find(c => c.id === 'no-combo');
                }
            }
            
            // Event Listeners
            categoryTabs.addEventListener('click', e => {
                if (e.target.tagName === 'BUTTON') {
                    document.querySelectorAll('.tab-button').forEach(btn => {
                        btn.classList.remove('tab-active');
                        btn.classList.add('tab-inactive');
                    });
                    e.target.classList.add('tab-active');
                    e.target.classList.remove('tab-inactive');
                    renderMenuItems(e.target.dataset.category);
                }
            });

            menuItemsContainer.addEventListener('click', e => {
                const card = e.target.closest('.item-card');
                if (card) {
                    document.querySelectorAll('.item-card').forEach(c => c.classList.remove('selected'));
                    card.classList.add('selected');

                    currentOrder.mainCourse = {
                        name: card.dataset.name,
                        price: parseInt(card.dataset.price)
                    };
                    checkComboEligibility();
                    updateSummary();
                }
            });
            
            comboOptionsContainer.addEventListener('change', e => {
                const comboId = e.target.value;
                currentOrder.combo = menuData.combos.find(c => c.id === comboId);
                updateSummary();
            });

            drinkSelect.addEventListener('change', e => {
                const selectedOption = e.target.options[e.target.selectedIndex];
                currentOrder.drink = {
                    name: selectedOption.value,
                    price: parseInt(selectedOption.dataset.price)
                }
                updateSummary();
            });

            dessertSelect.addEventListener('change', e => {
                const selectedOption = e.target.options[e.target.selectedIndex];
                currentOrder.dessert = {
                    name: selectedOption.value,
                    price: parseInt(selectedOption.dataset.price)
                }
                updateSummary();
            });

            userNameInput.addEventListener('input', e => {
                currentOrder.user = e.target.value;
                updateSummary();
            });
            
            document.getElementById('submit-order').addEventListener('click', () => {
                 const submitButton = document.getElementById('submit-order');
                 const summary = document.getElementById('summary-items');

                 // ç§»é™¤èˆŠçš„éŒ¯èª¤è¨Šæ¯
                 const oldError = document.getElementById('error-message');
                 if (oldError) oldError.remove();

                 if (!currentOrder.user) {
                     userNameInput.focus();
                     userNameInput.classList.add('border-red-500', 'ring-red-500');
                     return;
                 } else {
                     userNameInput.classList.remove('border-red-500', 'ring-red-500');
                 }

                 if (!currentOrder.mainCourse) {
                    summary.innerHTML = '<p id="error-message" class="text-center text-red-500 font-bold">è«‹è‡³å°‘é¸æ“‡ä¸€æ¨£ä¸»é¤ï¼</p>';
                    return;
                 }
                 
                 // ç¦ç”¨æŒ‰éˆ•ä¸¦é¡¯ç¤ºè®€å–ç‹€æ…‹
                 submitButton.disabled = true;
                 submitButton.textContent = 'è¨‚å–®é€å‡ºä¸­...';

                 const orderData = {
                    timestamp: new Date().toLocaleString('zh-TW', { timeZone: 'Asia/Taipei' }),
                    user: currentOrder.user,
                    mainCourse: currentOrder.mainCourse?.name || 'ç„¡',
                    mainCoursePrice: currentOrder.mainCourse?.price || 0,
                    combo: currentOrder.combo?.name || 'ç„¡',
                    comboPrice: currentOrder.combo?.price || 0,
                    drink: currentOrder.drink?.name || 'ç„¡',
                    drinkPrice: (currentOrder.drink && currentOrder.drink.name !== 'ä¸é»é£²æ–™') ? currentOrder.drink.price : 0,
                    dessert: currentOrder.dessert?.name || 'ç„¡',
                    dessertPrice: (currentOrder.dessert && currentOrder.dessert.name !== 'ä¸é»ç”œé»') ? currentOrder.dessert.price : 0,
                    total: currentOrder.totalPrice
                 };

                 // ä½¿ç”¨åŸºç¤ç¶²å€ + /submit
                 fetch(`${BACKEND_BASE_URL}/submit`, {
                    method: 'POST',
                    mode: 'cors',
                    cache: 'no-cache',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(orderData),
                    redirect: 'follow'
                 })
                 .then(response => response.json())
                 .then(data => {
                    if(data.result === 'success') {
                        document.getElementById('confirmation-message').classList.remove('hidden');
                        submitButton.textContent = 'è¨‚å–®å·²é€å‡º';
                        // æˆåŠŸé€å‡ºè¨‚å–®å¾Œï¼Œç«‹åˆ»é‡æ–°æŠ“å–ä¸€æ¬¡å³æ™‚åˆ—è¡¨
                        fetchLiveOrders(); 
                    } else {
                        throw new Error(data.error || 'æäº¤å¤±æ•—');
                    }
                 })
                 .catch(error => {
                    console.error('Error:', error);
                    summary.innerHTML += '<p id="error-message" class="text-center text-red-500 font-bold">é€å‡ºå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦æˆ–è¯ç¹«ä¸»è¾¦äººã€‚</p>';
                    submitButton.disabled = false;
                    submitButton.textContent = 'é‡æ–°é€å‡ºè¨‚å–®';
                 });
            });

            // Initial Render
            renderTabs();
            renderMenuItems(menuData.categories[0]);
            renderCombos();
            renderSelectOptions(drinkSelect, menuData.drinks);
            renderSelectOptions(dessertSelect, menuData.desserts);
            updateSummary();
            
            // é é¢è¼‰å…¥æ™‚ï¼ŒæŠ“å–ä¸€æ¬¡å³æ™‚è¨‚å–®
            fetchLiveOrders();
        });
    </script>
</body>
</html>
